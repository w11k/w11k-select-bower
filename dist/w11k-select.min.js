/**
 * @version v0.10.1
 * @link https://github.com/w11k/w11k-select
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("angular")):"function"==typeof define&&define.amd?define(["exports","angular"],t):t(e["w11k-select"]=e["w11k-select"]||{},e.angular)}(this,function(e,t){"use strict";
f.$inject = ["e", "i", "o", "c", "s", "f", "d", "p"];
d.$inject = ["e"];
w.$inject = ["e"];function n(e,t){for(var i=e.length;i--;)e[i].selected=t,e[i].state=t?k.selected:k.unselected,n(e[i].children||[],t)}function i(e,t){var n={};return n[t.item]=e,t.value(n)}function o(e,t){return i(e.model,t)}function r(e,t,n){var i=[];return e.forEach(function(e){return c(e,i,t)}),i}function c(e,t,n){e.state===k.selected&&t.push(o(e,n)),e.children.forEach(function(e){return c(e,t,n)})}function l(e,t,n){if(void 0!==n.tracking){var i={},o=n.value.assign;o(i,e);var r=n.tracking(i);if(void 0===r)throw new Error("Couldn't get 'track by' value. Please make sure to only use something in 'track byâ€™ part of w11kSelectOptions expression, accessible from result of value part. ('option.data' and 'option.data.unique' but not 'option.unique')");return r.toString()}return t.hashCode(e)}function s(e,t){var n={};return n[t.item]=e,t.label(n)}function a(e,t,n,o,r){function c(e,t){var u=i(e,o),f=l(u,n,o),d=s(e,o),p=new C(f,d,e,!!a[f],a[f]?k.selected:k.unselected,[],t||null);return e[r.children]&&(p.children=e[r.children].map(function(e){return c(e,f)})),p}for(var a={},u=t.length;u--;){var f=l(t[u],n,o);a[f]=!0}return e.map(c)}function u(e,t){e.state===k.selected&&t.push(e.label),e.children.forEach(function(e){return u(e,t)})}function f(e,i,o,c,s,f,d,p){"ngInject";var h=t.element(d);return{restrict:"A",replace:!1,templateUrl:e.common.templateUrl,scope:{},require:"ngModel",controller:["e", "t", "n", function(e,t,n){if(t.w11kSelect&&t.w11kSelect.length>0){var i=n(t.w11kSelect);i.assign&&i.assign(e.$parent,this)}this.open=function(){e.dropdown.open()},this.close=function(){e.dropdown.close()},this.toggle=function(){e.dropdown.toggle()}}],compile:function(g,v){var w=i(v.w11kSelectConfig),m=c.parseOptions(v.w11kSelectOptions),y=i(v.ngModel).assign,S=m.value.assign;if(void 0!==m.tracking&&void 0===S)throw new Error("value part of w11kSelectOptions expression must be assignable if 'track by' is used");return function(i,g,v,S){function $(){Q.then(function(){C(),P(),x(i.config,H)}),N||(b(),N=!0)}function b(){if(i.config.filter.select.active&&i.config.filter.select.text){var e=V.querySelector(".select-filtered-text");e.textContent=i.config.filter.select.text}if(i.config.filter.deselect.active&&i.config.filter.deselect.text){var t=V.querySelector(".deselect-filtered-text");t.textContent=i.config.filter.deselect.text}if(i.config.header.placeholder){var n=V.querySelector(".header-placeholder");n.textContent=i.config.header.placeholder}}function C(){if(i.config.multiple===!1){var e=T.filter(function(e){return e.state===k.selected});e.length>0&&(n(e,!1),e[0].state=k.selected)}}function I(e){27===e.keyCode&&i.dropdown.close&&i.dropdown.close()}function D(){if(t.isDefined(i.config.style.maxHeight))L.style.maxHeight=i.style.maxHeight;else{var e=E();L.style.maxHeight=e+"px"}}function O(){L.style.maxHeight=""}function E(){var e,n,o,r=L.getBoundingClientRect().top,c=d.innerHeight||d.document.documentElement.clientHeight;if(t.isDefined(R)?(n=R.innerHeight||R.clientHeight,o=R.getBoundingClientRect().top):(n=d.innerHeight||d.document.documentElement.clientHeight,o=0),i.config.style.marginBottom.indexOf("px")<0)throw new Error("Illegal Value for w11kSelectStyle.marginBottom");var l,s,a=parseFloat(i.config.style.marginBottom.slice(0,-2));n+o>c?(l=c,s=0):(l=n,s=o),e=l-(r-s)-a;var u=93;return e<u&&(e=u),e}function A(){if(t.isDefined(i.config.header.text))W.textContent=i.$parent.$eval(i.config.header.text);else{var e=[];T.forEach(function(t){return u(t,e)}),W.textContent=e.join(", ")}}function q(){B&&(_=X(T,i.filter.values,!1),i.options.visible=_.slice(0,J))}function H(){var t=r(T,m,e);S.$setViewValue(t),A()}function P(){var n=r(T,m,e);t.forEach(S.$parsers,function(e){n=e(n)}),y(i.$parent,n)}function F(){Q.then(function(){ee=!0;var e=S.$viewValue;n(T,!1);for(var t=e.length;t--;){var i=l(e[t],c,m),o=Z[i];o&&(o.state=k.selected)}A()})}function j(e){var n;return n=t.isArray(e)?e:t.isDefined(e)?[e]:[]}function M(e){if(!t.isUndefined(e)){var n;return n=i.config.multiple?e:e[0]}}function z(e){return(i.config.multiple!==!0||i.config.required!==!0||0!==e.length)&&(i.config.multiple!==!1||i.config.required!==!0||void 0!==e)}function U(){var e=S.$viewValue;return!(t.isArray(e)&&e.length>0)}var V=g[0],B=!1,T=[],Z={},_=[];i.options={visible:[]},i.filter={values:{}},i.config=t.copy(e.instance);var N=!1;i.$watch(function(){return w(i.$parent)},function(e){t.isArray(e)?(c.extendDeep.apply(null,[i.config].concat(e)),$()):t.isObject(e)&&(c.extendDeep(i.config,e),$())},!0);var K=V.querySelector(".dropdown-menu"),L=V.querySelector(".dropdown-menu .content"),R=c.getParent(g,".w11k-select-adjust-height-to"),W=V.querySelector(".header-text");i.dropdown={onOpen:function(e){return i.config.disabled?void e.prevent():(B===!1&&(B=!0),q(),o.on("keyup",I),K.style.visibility="hidden",f(function(){D(),K.style.visibility="visible",i.config.filter.active&&f(function(){g[0].querySelector(".dropdown-menu input").focus()})}),h.on("resize",D),void(t.isFunction(i.config.dropdown.onOpen)&&i.config.dropdown.onOpen()))},onClose:function(){i.filter.values.label="",f(function(){O()}),o.off("keyup",I),h.off("resize",D),t.isFunction(i.config.dropdown.onClose)&&i.config.dropdown.onClose()}},i.$on("$destroy",function(){o.off("keyup",I),h.off("resize",D)}),i.onKeyPressedOnDropDownToggle=function(e){13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),e.stopPropagation(),i.dropdown.toggle())};var X=s("filter"),J=80,G=.5*J;i.showMoreOptions=function(){i.options.visible=_.slice(0,i.options.visible.length+G)},i.onFilterValueChanged=function(){q()},i.clearFilter=function(){i.filter.values={},q()},i.onKeyPressedInFilter=function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),i.selectFiltered())},i.selectFiltered=function(e){t.isDefined(e)&&(e.preventDefault(),e.stopPropagation()),i.config.multiple?n(_,!0):1===_.length&&i.select(_[0]),H()},i.deselectFiltered=function(e){t.isDefined(e)&&(e.preventDefault(),e.stopPropagation()),n(_,!1),H()},i.deselectAll=function(e){t.isDefined(e)&&(e.preventDefault(),e.stopPropagation()),n(T,!1),H()};var Q,Y=function(){var e=p.defer();return Q=e.promise,function(){var n=m.collection(i.$parent),o=S.$viewValue;if(t.isArray(n)){T=a(n,o,c,m,i.config),Z={};for(var r=T.length;r--;){var l=T[r];if(Z[l.trackingId])throw new Error("Duplicate hash value for options "+l.label+" and "+Z[l.trackingId].label);Z[l.trackingId]=l}q(),ee&&P(),e.resolve()}}}();i.$watchCollection(function(){return m.collection(i.$parent)},function(e){t.isDefined(e)&&Y()}),i.select=function(e){return i.config.multiple?void H():(n(T,!1),e.state=k.selected,H(),void i.dropdown.close())};var ee;i.isEmpty=U,S.$isEmpty=U,S.$render=F,S.$formatters.push(j),S.$validators.required=z,S.$parsers.push(M)}}}}function d(e){"ngInject";return{restrict:"A",replace:!1,templateUrl:e.common.templateUrlOptions,scope:{options:"=",parent:"=",select:"&"},require:"ngModel",controller:["e", "t", "n", function(e,t,n){e.$parent.childsMap&&e.$parent.addChild(e,e.parent),e.childsMap={},e.upwardsClick=function(t,n){var i=e.options.find(function(e){return e.trackingId===t.parent});if(0===n.selected&&0===n.childsSelected?g(i,k.unselected,e):n.selected===n.length?g(i,k.selected,e):g(i,k.childsSelected,e),e.$parent.upwardsClick){var o=h(e.options);e.$parent.upwardsClick(i,o)}},e.addChild=function(t,n){e.childsMap[n.trackingId]=t},e.onOptionStateClick=function(t,n){switch(n.state){case k.unselected:g(n,k.selected,e);break;case k.selected:g(n,k.unselected,e);break;case k.childsSelected:g(n,k.selected,e)}if(e.$parent.upwardsClick){var i=h(e.options);e.$parent.upwardsClick(n,i)}e.childsMap[n.trackingId].downWardstoggleAll(n.state)},e.downWardstoggleAll=function(t){e.options=p(e.options,t,e)}}]}}function p(e,t,n){return e.map(function(e){return e.children=p(e.children,t,n),g(e,t,n),e})}function h(e){return e.reduce(function(e,t){return t.state===k.selected&&e.selected++,t.state===k.unselected&&e.unselected++,t.state===k.childsSelected&&e.childsSelected++,e},new I(e.length))}function g(e,t,n){e.state=t,n.select({option:e})}function v(){return{scope:{state:"="},bindToController:!0,controllerAs:"$ctrl",template:'<a class="w11k-checkbox" ng-class="$ctrl.getClass($ctrl.state)"></a>',restrict:"E",controller:D}}function w(e){"ngInject";return{link:function(t,n,i){var o=0,r=!0,c=!1,l=function(){u(!0)},s=n[0];if(1!==s.children.length)throw new Error("scroll container has to have exactly one child!");var a=s.children[0],u=function(e){var n=a.clientHeight-s.scrollTop,l=n<=s.clientHeight*(o+1);l&&r?e?t.$apply(function(){t.$eval(i.w11kSelectInfiniteScroll)}):t.$eval(i.w11kSelectInfiniteScroll):l&&(c=!0)};return i.$observe("w11kSelectInfiniteScrollDistance",function(e){o=parseFloat(e)}),i.$observe("w11kSelectInfiniteScrollDisabled",function(e){r=!e,r&&c&&(c=!1,u())}),n.on("scroll",l),t.$on("$destroy",function(){n.off("scroll",l)}),e(function(){i.w11kSelectInfiniteScrollImmediateCheck&&t.$eval(i.w11kSelectInfiniteScrollImmediateCheck)&&u()})}}}function m(){return function(e,t,n){t.bind("keydown",function(e){32===e.keyCode&&e.preventDefault()}),t.bind("keyup",function(t){32!==t.keyCode&&13!==t.keyCode||e.$apply(n.keyListener)})}}var k,y=function(){function e(){this.templateUrl="w11k-select.tpl.html",this.templateUrlOptions="w11k-select-option.tpl.html"}return e}(),S=function(){function e(){this.required=!1,this.hideCheckboxes=!1,this.multiple=!0,this.disabled=!1,this.header={placeholder:"",text:void 0},this.dropdown={onOpen:void 0,onClose:void 0},this.filter={active:!0,placeholder:"Filter",select:{active:!0,text:void 0},deselect:{active:!0,text:void 0}},this.style={marginBottom:"10px",maxHeight:void 0},this.showClearAlways=!1}return e}(),$=function(){function e(e,t){this.common=e||new y,this.instance=t||new S}return e}(),b=function(){
e.$inject = ["e", "n"];function e(e,n){"ngInject";var i=this;this.$parse=e,this.$document=n,this.OPTIONS_EXP=/^([a-zA-Z][\w\.]*)(?:\s+as\s+([a-zA-Z][\w\.]*))?\s+for\s+(?:([a-zA-Z][\w]*))\s+in\s+([$_a-zA-Z][\w\.\(\)]*(?:\s+\|\s[a-zA-Z][\w\:_\{\}']*)*)(?:\s+track\sby\s+([a-zA-Z][\w\.]*))?$/,this.extendDeep=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return t.forEach(n,function(n){n!==e&&t.forEach(n,function(t,n){e[n]&&e[n].constructor&&e[n].constructor===Object?i.extendDeep(e[n],t):e[n]=t})}),e}}return e.prototype.hashCode=function(e){var n;n="object"==typeof e?t.toJson(e):e.toString();for(var i=0,o=n.length,r=0;r<o;r++)i=n.charCodeAt(r)+(i<<6)+(i<<16)-i;return i.toString(36)},e.prototype.parseOptions=function(e){var t=e.match(this.OPTIONS_EXP);if(!t){var n='"item.value" [as "item.label"] for "item" in "collection [ | filter ] [track by item.value.unique]"';throw new Error("Expected options in form of '"+n+"' but got \""+e+'".')}var i={value:this.$parse(t[1]),label:this.$parse(t[2]||t[1]),item:t[3],collection:this.$parse(t[4])};return void 0!==t[5]&&(i.tracking=this.$parse(t[5])),i},e.prototype.getParent=function(e,n){if(t.isFunction(e.parents)){var i=e.parents(n);if(i.length>0)return i[0]}else{var o="MatchesSelector",r=["matches","matchesSelector","moz"+o,"webkit"+o,"ms"+o,"o"+o];for(var c in r){var l=r[c];if(t.isFunction(e[0][l])){for(var s=e[0].parentNode;s!==this.$document[0];){if(s[l](n))return s;s=s.parentNode}return}}}},e}();!function(e){e[e.unselected=0]="unselected",e[e.selected=1]="selected",e[e.childsSelected=2]="childsSelected"}(k||(k={}));var C=function(){function e(e,t,n,i,o,r,c){this.trackingId=e,this.label=t,this.model=n,this.selected=i,this.state=o,this.children=r,this.parent=c}return e}(),x=function(e,t){if(e.children&&!e.multiple)throw new Error("Multiple must be enabled when displaying hierarchically structure");e.children&&t()},I=function(){function e(e){this.selected=0,this.unselected=0,this.childsSelected=0,this.length=e}return e}(),D=function(){function e(){}return e.prototype.getClass=function(e){return k[e]},e}(),O=t.module("w11k.select",["w11k.dropdownToggle","w11k.select.template"]);O.constant("w11kSelectConfig",new $).directive("w11kSelectInfiniteScroll",w).service("w11kSelectHelper",b).directive("w11kSelect",f).directive("w11kSelectOption",d).directive("w11kSelectCheckbox",v).directive("keyListener",m),e.module=O,e.Config=$,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=w11k-select.min.js.map
