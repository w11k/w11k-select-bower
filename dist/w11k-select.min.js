/**
 * @version v0.11.0
 * @link https://github.com/w11k/w11k-select
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("angular")):"function"==typeof define&&define.amd?define(["exports","angular"],t):t(e["w11k-select"]=e["w11k-select"]||{},e.angular)}(this,function(e,t){"use strict";
d.$inject = ["e", "i", "o", "c", "s", "d", "h", "g"];
h.$inject = ["e"];
k.$inject = ["e"];function n(e,t){for(var i=e.length;i--;)e[i].selected=t,e[i].state=t?S.selected:S.unselected,n(e[i].children||[],t)}function i(e,t){var n={};return n[t.item]=e,t.value(n)}function o(e,t){return i(e.model,t)}function r(e,t,n){var i=[];return e.forEach(function(e){return c(e,i,t)}),i}function c(e,t,n){e.state===S.selected&&t.push(o(e,n)),e.children.forEach(function(e){return c(e,t,n)})}function l(e,t,n){if(void 0!==n.tracking){var i={};(0,n.value.assign)(i,e);var o=n.tracking(i);if(void 0===o)throw new Error("Couldn't get 'track by' value. Please make sure to only use something in 'track byâ€™ part of w11kSelectOptions expression, accessible from result of value part. ('option.data' and 'option.data.unique' but not 'option.unique')");return o.toString()}return t.hashCode(e)}function s(e,t){var n={};return n[t.item]=e,t.label(n)}function a(e,t,n,o,r){function c(e,t){var u=i(e,o),f=l(u,n,o),d=s(e,o),p=new O(f,d,e,!!a[f],a[f]?S.selected:S.unselected,[],t||null);return e[r.children]&&(p.children=e[r.children].map(function(e){return c(e,f)})),p}for(var a={},u=t.length;u--;){var f=l(t[u],n,o);a[f]=!0}return e.map(c)}function u(e,t){e.state===S.selected&&t.push(e.label),e.children.forEach(function(e){return u(e,t)})}function f(e,t){e.forEach(function(e){if(t[e.trackingId])throw new Error("Duplicate hash value for options "+e.label+" and "+t[e.trackingId].label);t[e.trackingId]=e,e.children&&f(e.children,t)})}function d(e,i,o,c,s,d,h,g){"ngInject";var v=t.element(h);return{restrict:"A",replace:!1,templateUrl:e.common.templateUrl,scope:{},require:"ngModel",controller:["e", "t", "n", function(e,t,n){if(t.w11kSelect&&t.w11kSelect.length>0){var i=n(t.w11kSelect);i.assign&&i.assign(e.$parent,this)}this.open=function(){e.dropdown.open()},this.close=function(){e.dropdown.close()},this.toggle=function(){e.dropdown.toggle()}}],compile:function(w,m){var k=i(m.w11kSelectConfig),y=c.parseOptions(m.w11kSelectOptions),$=i(m.ngModel).assign,b=y.value.assign;if(void 0!==y.tracking&&void 0===b)throw new Error("value part of w11kSelectOptions expression must be assignable if 'track by' is used");return function(i,w,m,b){function x(){B.then(function(){O(),M(),p(i.config,P)}),R||(C(),R=!0)}function C(){if(i.config.filter.select.active&&null!==i.config.filter.select.text&&void 0!==i.config.filter.select.text){T.querySelector(".select-filtered-text").textContent=i.config.filter.select.text}if(i.config.filter.deselect.active&&null!==i.config.filter.deselect.text&&void 0!==i.config.filter.deselect.text){T.querySelector(".deselect-filtered-text").textContent=i.config.filter.deselect.text}if(null!==i.config.header.placeholder&&void 0!==i.config.header.placeholder){T.querySelector(".header-placeholder").textContent=i.config.header.placeholder}}function O(){if(!1===i.config.multiple){var e=N.filter(function(e){return e.state===S.selected});e.length>0&&(n(e,!1),e[0].state=S.selected)}}function I(e){27===e.keyCode&&i.dropdown.close&&i.dropdown.close()}function D(){if(t.isDefined(i.config.style.maxHeight))X.style.maxHeight=i.config.style.maxHeight;else{var e=A();X.style.maxHeight=e+"px"}}function E(){X.style.maxHeight=""}function A(){var e,n,o,r=X.getBoundingClientRect().top,c=h.innerHeight||h.document.documentElement.clientHeight;if(t.isDefined(J)?(n=J.innerHeight||J.clientHeight,o=J.getBoundingClientRect().top):(n=h.innerHeight||h.document.documentElement.clientHeight,o=0),i.config.style.marginBottom.indexOf("px")<0)throw new Error("Illegal Value for w11kSelectStyle.marginBottom");var l,s,a=parseFloat(i.config.style.marginBottom.slice(0,-2));n+o>c?(l=c,s=0):(l=n,s=o),e=l-(r-s)-a;return e<93&&(e=93),e}function q(){if(t.isDefined(i.config.header.text))G.textContent=i.$parent.$eval(i.config.header.text);else{var e=[];N.forEach(function(t){return u(t,e)}),G.textContent=e.join(", ")}}function H(){_&&(L=Q(N,i.filter.values,!1),i.options.visible=L.slice(0,Y))}function P(){var t=r(N,y,e);b.$setViewValue(t),q()}function M(){var n=r(N,y,e);t.forEach(b.$parsers,function(e){n=e(n)}),$(i.$parent,n)}function F(){B.then(function(){Z=!0;var e=b.$viewValue;n(N,!1);for(var t=e.length;t--;){var i=l(e[t],c,y),o=K[i];o&&(o.state=S.selected)}q()})}function j(e){return t.isArray(e)?e:t.isDefined(e)?[e]:[]}function z(e){if(!t.isUndefined(e)){return i.config.multiple||i.config.forceArrayOutput?e:e[0]}}function U(e){if(i.config.required){if(!0===i.config.multiple&&0===e.length)return!1;if(!1===i.config.multiple&&!0===i.config.forceArrayOutput&&0===e.length)return!1;if(!1===i.config.multiple&&void 0===e)return!1}return!0}function V(){var e=b.$viewValue;return!(t.isArray(e)&&e.length>0)}var B,T=w[0],Z=!1,_=!1,N=[],K={},L=[];i.options={visible:[]},i.filter={values:{}},i.config=t.copy(e.instance);var R=!1;i.$watch(function(){return k(i.$parent)},function(e){t.isArray(e)?(c.extendDeep.apply(null,[i.config].concat(e)),x()):t.isObject(e)&&(c.extendDeep(i.config,e),x())},!0);var W=T.querySelector(".dropdown-menu"),X=T.querySelector(".dropdown-menu .content"),J=c.getParent(w,".w11k-select-adjust-height-to"),G=T.querySelector(".header-text");i.dropdown={onOpen:function(e){if(i.config.disabled)return void e.prevent();!1===_&&(_=!0),H(),o.on("keyup",I),W.style.visibility="hidden",d(function(){D(),W.style.visibility="visible",i.config.filter.active&&d(function(){w[0].querySelector(".dropdown-menu input").focus()})}),v.on("resize",D),t.isFunction(i.config.dropdown.onOpen)&&i.config.dropdown.onOpen()},onClose:function(){i.filter.values.label="",d(function(){E()}),o.off("keyup",I),v.off("resize",D),t.isFunction(i.config.dropdown.onClose)&&i.config.dropdown.onClose()}},i.$on("$destroy",function(){o.off("keyup",I),v.off("resize",D)}),i.onKeyPressedOnDropDownToggle=function(e){13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),e.stopPropagation(),i.dropdown.toggle())};var Q=s("filter"),Y=80,ee=.5*Y;i.showMoreOptions=function(){i.options.visible=L.slice(0,i.options.visible.length+ee)},i.onFilterValueChanged=function(){H()},i.clearFilter=function(){i.filter.values={},H()},i.onKeyPressedInFilter=function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),i.selectFiltered())},i.selectFiltered=function(e){t.isDefined(e)&&(e.preventDefault(),e.stopPropagation()),i.config.multiple?n(L,!0):1===L.length&&i.select(L[0]),P()},i.deselectFiltered=function(e){t.isDefined(e)&&(e.preventDefault(),e.stopPropagation()),n(L,!1),P()},i.deselectAll=function(e){t.isDefined(e)&&(e.preventDefault(),e.stopPropagation()),n(N,!1),P()};var te=function(){var e=g.defer();return B=e.promise,function(){var n=y.collection(i.$parent),o=b.$viewValue;t.isArray(n)&&(N=a(n,o,c,y,i.config),K={},f(N,K),H(),Z&&M(),e.resolve())}}();i.$watchCollection(function(){return y.collection(i.$parent)},function(e){t.isDefined(e)&&te()}),i.select=function(e){if(i.config.multiple)return void P();n(N,!1),e.state=S.selected,P(),i.dropdown.close()},i.isEmpty=V,b.$isEmpty=V,b.$render=F,b.$formatters.push(j),b.$validators.required=U,b.$parsers.push(z)}}}}function p(e,t){if(e.children&&!e.multiple)throw new Error("Multiple must be enabled when displaying hierarchically structure");e.children&&t()}function h(e){"ngInject";return{restrict:"A",replace:!1,templateUrl:e.common.templateUrlOptions,scope:{options:"=",parent:"=",select:"&"},require:"ngModel",controller:["e", function(e){e.$parent.childsMap&&e.$parent.addChild(e,e.parent),e.childsMap={},e.upwardsClick=function(t,n){var i=e.options.find(function(e){return e.trackingId===t.parent});if(0===n.selected&&0===n.childsSelected?w(i,S.unselected,e):n.selected===n.length?w(i,S.selected,e):w(i,S.childsSelected,e),e.$parent.upwardsClick){var o=v(e.options);e.$parent.upwardsClick(i,o)}},e.addChild=function(t,n){e.childsMap[n.trackingId]=t},e.onOptionStateClick=function(t,n){switch(n.state){case S.unselected:w(n,S.selected,e);break;case S.selected:w(n,S.unselected,e);break;case S.childsSelected:w(n,S.selected,e)}if(e.$parent.upwardsClick){var i=v(e.options);e.$parent.upwardsClick(n,i)}e.childsMap[n.trackingId].downWardstoggleAll(n.state)},e.downWardstoggleAll=function(t){e.options=g(e.options,t,e)}}]}}function g(e,t,n){return e.map(function(e){return e.children=g(e.children,t,n),w(e,t,n),e})}function v(e){return e.reduce(function(e,t){return t.state===S.selected&&e.selected++,t.state===S.unselected&&e.unselected++,t.state===S.childsSelected&&e.childsSelected++,e},new I(e.length))}function w(e,t,n){e.state=t,n.select({option:e})}function m(){return{scope:{state:"="},bindToController:!0,controllerAs:"$ctrl",template:'<a class="w11k-checkbox" ng-class="$ctrl.getClass($ctrl.state)"></a>',restrict:"E",controller:D}}function k(e){"ngInject";return{link:function(t,n,i){var o=0,r=!0,c=!1,l=function(){u(!0)},s=n[0];if(1!==s.children.length)throw new Error("scroll container has to have exactly one child!");var a=s.children[0],u=function(e){var n=a.clientHeight-s.scrollTop,l=n<=s.clientHeight*(o+1);l&&r?e?t.$apply(function(){t.$eval(i.w11kSelectInfiniteScroll)}):t.$eval(i.w11kSelectInfiniteScroll):l&&(c=!0)};return i.$observe("w11kSelectInfiniteScrollDistance",function(e){o=parseFloat(e)}),i.$observe("w11kSelectInfiniteScrollDisabled",function(e){(r=!e)&&c&&(c=!1,u())}),n.on("scroll",l),t.$on("$destroy",function(){n.off("scroll",l)}),e(function(){i.w11kSelectInfiniteScrollImmediateCheck&&t.$eval(i.w11kSelectInfiniteScrollImmediateCheck)&&u()})}}}function y(){return function(e,t,n){t.bind("keydown",function(e){32===e.keyCode&&e.preventDefault()}),t.bind("keyup",function(t){32!==t.keyCode&&13!==t.keyCode||e.$apply(n.keyListener)})}}var S,$=function(){function e(){this.templateUrl="w11k-select.tpl.html",this.templateUrlOptions="w11k-select-option.tpl.html"}return e}(),b=function(){function e(){this.required=!1,this.hideCheckboxes=!1,this.multiple=!0,this.forceArrayOutput=!1,this.disabled=!1,this.header={placeholder:"",text:void 0},this.dropdown={onOpen:void 0,onClose:void 0},this.filter={active:!0,placeholder:"Filter",select:{active:!0,text:void 0},deselect:{active:!0,text:void 0}},this.style={marginBottom:"10px",maxHeight:void 0},this.showClearAlways=!1}return e}(),x=function(){function e(e,t){this.common=e||new $,this.instance=t||new b}return e}(),C=function(){
e.$inject = ["e", "t"];function e(e,t){"ngInject";this.$parse=e,this.$document=t,this.OPTIONS_EXP=/^([a-zA-Z][\w\.]*)(?:\s+as\s+([a-zA-Z][\w\.]*))?\s+for\s+(?:([a-zA-Z][\w]*))\s+in\s+([$_a-zA-Z][\w\.\(\)]*(?:\s+\|\s[a-zA-Z][\w\:_\{\}']*)*)(?:\s+track\sby\s+([a-zA-Z][\w\.]*))?$/}return e.prototype.extendDeep=function(e){for(var n=this,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];return t.forEach(i,function(i){i!==e&&t.forEach(i,function(t,i){e[i]&&e[i].constructor&&e[i].constructor===Object?n.extendDeep(e[i],t):e[i]=t})}),e},e.prototype.hashCode=function(e){var n;n="object"==typeof e?t.toJson(e):e.toString();for(var i=0,o=n.length,r=0;r<o;r++)i=n.charCodeAt(r)+(i<<6)+(i<<16)-i;return i.toString(36)},e.prototype.parseOptions=function(e){var t=e.match(this.OPTIONS_EXP);if(!t){throw new Error('Expected options in form of \'"item.value" [as "item.label"] for "item" in "collection [ | filter ] [track by item.value.unique]"\' but got "'+e+'".')}var n={value:this.$parse(t[1]),label:this.$parse(t[2]||t[1]),item:t[3],collection:this.$parse(t[4])};return void 0!==t[5]&&(n.tracking=this.$parse(t[5])),n},e.prototype.getParent=function(e,n){if(t.isFunction(e.parents)){var i=e.parents(n);if(i.length>0)return i[0]}else{var o=["matches","matchesSelector","mozMatchesSelector","webkitMatchesSelector","msMatchesSelector","oMatchesSelector"];for(var r in o){var c=o[r];if(t.isFunction(e[0][c])){for(var l=e[0].parentNode;l!==this.$document[0];){if(l[c](n))return l;l=l.parentNode}return}}}},e}();!function(e){e[e.unselected=0]="unselected",e[e.selected=1]="selected",e[e.childsSelected=2]="childsSelected"}(S||(S={}));var O=function(){function e(e,t,n,i,o,r,c){this.trackingId=e,this.label=t,this.model=n,this.selected=i,this.state=o,this.children=r,this.parent=c}return e}(),I=function(){function e(e){this.selected=0,this.unselected=0,this.childsSelected=0,this.length=e}return e}(),D=function(){function e(){}return e.prototype.getClass=function(e){return S[e]},e}(),E=t.module("w11k.select",["w11k.dropdownToggle","w11k.select.template"]);E.constant("w11kSelectConfig",new x).directive("w11kSelectInfiniteScroll",k).service("w11kSelectHelper",C).directive("w11kSelect",d).directive("w11kSelectOption",h).directive("w11kSelectCheckbox",m).directive("keyListener",y),e.module=E,e.Config=x,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=w11k-select.min.js.map
