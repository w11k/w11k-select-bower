{"version":3,"file":null,"sources":["../src/lib/set-selected.ts","../src/lib/external-option-2-value.ts","../src/lib/internal-option-2-value.ts","../src/lib/internal-options-2-external-model.ts","../src/lib/value-2-tracking-id.ts","../src/lib/external-option-2-label.ts","../src/lib/external-options-2-internal-options.ts","../src/lib/collect-active-labels.ts","../src/lib/build-internal-options-map.ts","../src/lib/array-exists-and-contains.ts","../src/lib/filter-internal-options.ts","../src/w11k-select.directive.ts","../src/w11k-select-option/w11k-select-option.directive.ts","../src/w11k-select-checkbox/w11k-checkbox.directive.ts","../src/w11k-select-infinite-scroll.directive.ts","../src/lib/key-listener.ts","../src/model/config.model.ts","../src/model/option-state.enum.ts","../src/w11k-select-helper.factory.ts","../src/model/internal-option.model.ts","../src/w11k-select.ts"],"sourcesContent":["import {InternalOption} from '../model/internal-option.model';\nimport {OptionState} from '../model/option-state.enum';\n\nexport function setSelected (options: InternalOption[], selected: boolean) {\n  let i = options.length;\n  while (i--) {\n    options[i].selected = selected;\n    options[i].state = selected ? OptionState.selected : OptionState.unselected;\n\n    setSelected(options[i].children || [], selected);\n  }\n}\n\n// Sets all options to selected (deep) where isSearchResultOrParent is true\nexport function setFilteredSelected (options: InternalOption[]) {\n  options.forEach(option => {\n    option.selected = option.isSearchResultOrParent;\n    option.state = option.selected ? OptionState.selected : OptionState.unselected;\n    setFilteredSelected(option.children || []);\n  });\n}\n","export function externalOption2value (option, optionsExpParsed) {\n  let context = {};\n  context[optionsExpParsed.item] = option;\n\n  return optionsExpParsed.value(context);\n}\n","import {externalOption2value} from './external-option-2-value';\n\nexport function internalOption2value (option, optionsExpParsed) {\n  return externalOption2value(option.model, optionsExpParsed);\n}\n","import {internalOption2value} from './internal-option-2-value';\nimport {Config} from '../model/config.model';\nimport {InternalOption} from '../model/internal-option.model';\nimport {OptionState} from '../model/option-state.enum';\n\nexport function internalOptions2externalModel (options, optionsExpParsed, config: Config) {\n  let arr = [];\n  options.forEach(option => traverse(option, arr, optionsExpParsed));\n  return arr;\n}\n\nfunction traverse (option: InternalOption, arr, optionsExpParsed) {\n  if (option.state === OptionState.selected) {\n    arr.push(internalOption2value(option, optionsExpParsed));\n  }\n  option.children.forEach(option => traverse(option, arr, optionsExpParsed));\n\n}\n","export function value2trackingId (value, w11kSelectHelper, optionsExpParsed) {\n  if (optionsExpParsed.tracking !== undefined) {\n    let context = {};\n    let assignValueFn = optionsExpParsed.value.assign;\n    assignValueFn(context, value);\n\n    let trackingValue = optionsExpParsed.tracking(context);\n\n    if (trackingValue === undefined) {\n      throw new Error('Couldn\\'t get \\'track by\\' value. Please make sure to only use something in \\'track byâ€™ part of w11kSelectOptions expression, accessible from result of value part. (\\'option.data\\' and \\'option.data.unique\\' but not \\'option.unique\\')');\n    }\n\n    return trackingValue.toString();\n  } else {\n    return w11kSelectHelper.hashCode(value);\n  }\n\n}\n","export function externalOption2label (option, optionsExpParsed) {\n  let context = {};\n  context[optionsExpParsed.item] = option;\n\n  return optionsExpParsed.label(context);\n}\n","import {externalOption2value} from './external-option-2-value';\nimport {externalOption2label} from './external-option-2-label';\nimport {value2trackingId} from './value-2-tracking-id';\nimport {OptionState} from '../model/option-state.enum';\nimport {ConfigInstance} from '../model/config.model';\nimport {InternalOption} from '../model/internal-option.model';\n\nexport function externalOptions2internalOptions (externalOptions, viewValue, w11kSelectHelper, optionsExpParsed, config: ConfigInstance): InternalOption[] {\n  let viewValueIDs = {};\n\n  let i = viewValue.length;\n\n  while (i--) {\n    let trackingId = value2trackingId(viewValue[i], w11kSelectHelper, optionsExpParsed);\n    viewValueIDs[trackingId] = true;\n  }\n\n  function prepareOptions (externalOption, parent?: string) {\n    let value = externalOption2value(externalOption, optionsExpParsed);\n    let trackingId = value2trackingId(value, w11kSelectHelper, optionsExpParsed);\n    let label = externalOption2label(externalOption, optionsExpParsed);\n\n    let internalOption = new InternalOption(\n        trackingId,\n        label,\n        externalOption,\n        !!viewValueIDs[trackingId],\n        viewValueIDs[trackingId] ? OptionState.selected : OptionState.unselected,\n        [],\n        parent || null\n    );\n\n    if (externalOption[config.children]) {\n      internalOption.children = externalOption[config.children].map(child => prepareOptions(child, trackingId));\n    }\n    return internalOption;\n  }\n\n  return externalOptions.map(prepareOptions);\n}\n","import {InternalOption} from '../model/internal-option.model';\nimport {OptionState} from '../model/option-state.enum';\n\nexport function collectActiveLabels (option: InternalOption, labelArray: string[]): void {\n  if (option.state === OptionState.selected) {\n    labelArray.push(option.label);\n  }\n  option.children.forEach(option => collectActiveLabels(option, labelArray));\n}\n","export function buildInternalOptionsMap (internalOptions, internalOptionsMap) {\n  internalOptions.forEach((option) => {\n    if (internalOptionsMap[option.trackingId]) {\n      throw new Error('Duplicate hash value for options ' + option.label + ' and ' + internalOptionsMap[option.trackingId].label);\n    }\n    internalOptionsMap[option.trackingId] = option;\n    if (option.children) {\n      buildInternalOptionsMap(option.children, internalOptionsMap);\n    }\n  });\n}\n","// Checks whether an array exists and contains items\nexport function arrayExistsAndContains (arr: any[] | null): boolean {\n  return !!arr && arr.length > 0;\n}\n","import {InternalOption} from '../model/internal-option.model';\nimport {arrayExistsAndContains} from './array-exists-and-contains';\n\nexport const filterInternals = function (resourceList: InternalOption[], searchStr: string): InternalOption[] {\n  return resourceList.map(it => {\n    if (arrayExistsAndContains(it.children)) {\n      it.children = filterInternals(it.children, searchStr);\n    }\n    it.isSearchResultOrParent = it.label.toString().toLowerCase().includes(searchStr) || ContainsResult(it.children);\n    return it;\n  });\n};\n\nfunction ContainsResult (resource: InternalOption[]): boolean {\n  return resource.some(resource => resource.isSearchResultOrParent || ContainsResult(resource.children));\n}\n","/** @internal */\nimport * as angular from 'angular';\nimport {IPromise, IScope, IFilterService, IWindowService, IQService, IDocumentService, IParseService, ITimeoutService} from 'angular';\nimport {setFilteredSelected, setSelected} from './lib/set-selected';\nimport {internalOptions2externalModel} from './lib/internal-options-2-external-model';\nimport {value2trackingId} from './lib/value-2-tracking-id';\nimport {externalOptions2internalOptions} from './lib/external-options-2-internal-options';\nimport {InternalOption} from './model/internal-option.model';\nimport {OptionState} from './model/option-state.enum';\nimport {Config, ConfigInstance} from './model/config.model';\nimport {collectActiveLabels} from './lib/collect-active-labels';\nimport {buildInternalOptionsMap} from './lib/build-internal-options-map';\nimport {W11KSelectHelper} from './w11k-select-helper.factory';\nimport {filterInternals} from './lib/filter-internal-options';\n\nexport interface Scope extends IScope {\n  config: ConfigInstance;\n  style: any;  // only required once?\n  onKeyPressedOnDropDownToggle: (event: any) => void;\n  showMoreOptions: () => void;\n  onFilterValueChanged: () => void;\n  clearFilter: () => void;\n  onKeyPressedInFilter: ($event: any) => void;\n  selectFiltered: ($event?: any) => void;\n  deselectFiltered: ($event: any) => void;\n  deselectAll: ($event: any) => void;\n  select: ($event: any) => void;\n  isEmpty: () => boolean;\n\n  options: {\n    visible: any[]\n  };\n  filter: {\n    values: any\n  };\n\n  dropdown: {\n    onOpen?: ($event: any) => void | undefined;\n    onClose?: () => void | undefined;\n    close?: () => void;\n    toggle?: any\n  };\n}\n\nexport function w11kSelect (w11kSelectConfig: Config,\n                            $parse: IParseService,\n                            $document: IDocumentService,\n                            w11kSelectHelper: W11KSelectHelper,\n                            $filter: IFilterService,\n                            $timeout: ITimeoutService,\n                            $window: IWindowService,\n                            $q: IQService) {\n  'ngInject';\n\n  let jqWindow = angular.element($window);\n\n  return {\n    restrict: 'A',\n    replace: false,\n    templateUrl: w11kSelectConfig.common.templateUrl,\n    scope: {},\n    require: 'ngModel',\n    controller: function ($scope, $attrs, $parse) {\n      if ($attrs.w11kSelect && $attrs.w11kSelect.length > 0) {\n        let exposeExpression = $parse($attrs.w11kSelect);\n\n        if (exposeExpression.assign) {\n          exposeExpression.assign($scope.$parent, this);\n        }\n      }\n\n      this.open = function () {\n        $scope.dropdown.open();\n      };\n\n      this.close = function () {\n        $scope.dropdown.close();\n      };\n\n      this.toggle = function () {\n        $scope.dropdown.toggle();\n      };\n    },\n    compile: function (tElement, tAttrs) {\n      let configExpParsed = $parse(tAttrs.w11kSelectConfig);\n      let optionsExpParsed = w11kSelectHelper.parseOptions(tAttrs.w11kSelectOptions);\n\n      let ngModelSetter = $parse(tAttrs.ngModel).assign;\n      let assignValueFn = optionsExpParsed.value.assign;\n\n      if (optionsExpParsed.tracking !== undefined && assignValueFn === undefined) {\n        throw new Error('value part of w11kSelectOptions expression must be assignable if \\'track by\\' is used');\n      }\n\n      return function (scope: Scope, iElement: any, iAttrs: any, controller: any) {\n        let domElement = iElement[0];\n\n        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n         * internal model\n         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n        let optionsAlreadyRead: IPromise<void>;\n        let ngModelAlreadyRead: boolean = false;\n\n        let hasBeenOpened = false;\n        let internalOptions: InternalOption[] = [];\n        let internalOptionsMap = {};\n        let optionsFiltered: InternalOption[] = [];\n\n        scope.options = {\n          visible: []\n        };\n\n        scope.filter = {\n          values: {}\n        };\n\n        scope.config = angular.copy(w11kSelectConfig.instance);\n\n        // marker to read some parts of the config only once\n        let configRead = false;\n\n        scope.$watch(\n            function () {\n              return configExpParsed(scope.$parent);\n            },\n            function (newConfig) {\n              if (angular.isArray(newConfig)) {\n                w11kSelectHelper.extendDeep.apply(w11kSelectHelper, [scope.config].concat(newConfig));\n                applyConfig();\n              } else if (angular.isObject(newConfig)) {\n                w11kSelectHelper.extendDeep(scope.config, newConfig);\n                applyConfig();\n              }\n            },\n            true\n        );\n\n        function applyConfig () {\n          optionsAlreadyRead.then(function () {\n            checkSelection();\n            updateNgModel();\n            checkConfig(scope.config, setViewValue);\n          });\n\n          if (!configRead) {\n            updateStaticTexts();\n            configRead = true;\n          }\n        }\n\n        function updateStaticTexts () {\n          if (scope.config.filter.select.active && scope.config.filter.select.text !== null && typeof(scope.config.filter.select.text) !== 'undefined') {\n            let selectFilteredButton = domElement.querySelector('.select-filtered-text');\n            selectFilteredButton.textContent = scope.config.filter.select.text;\n          }\n\n          if (scope.config.filter.deselect.active && scope.config.filter.deselect.text !== null && typeof(scope.config.filter.deselect.text) !== 'undefined') {\n            let deselectFilteredButton = domElement.querySelector('.deselect-filtered-text');\n            deselectFilteredButton.textContent = scope.config.filter.deselect.text;\n          }\n\n          if (scope.config.header.placeholder !== null && typeof(scope.config.header.placeholder) !== 'undefined') {\n            let headerPlaceholder = domElement.querySelector('.header-placeholder');\n            headerPlaceholder.textContent = scope.config.header.placeholder;\n          }\n        }\n\n        function checkSelection () {\n          if (scope.config.multiple === false) {\n            let selectedOptions: InternalOption[] = internalOptions.filter(\n                (option) => option.state === OptionState.selected\n            );\n\n            if (selectedOptions.length > 0) {\n              setSelected(selectedOptions, false);\n              selectedOptions[0].state = OptionState.selected;\n            }\n          }\n        }\n\n        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n         * dropdown\n         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n        let domDropDownMenu = domElement.querySelector('.dropdown-menu');\n        let domDropDownContent = domElement.querySelector('.dropdown-menu .content');\n        let domHeightAdjustContainer = w11kSelectHelper.getParent(iElement, '.w11k-select-adjust-height-to');\n        let domHeaderText = domElement.querySelector('.header-text');\n\n        function onEscPressed (event) {\n          if (event.keyCode === 27) {\n            if (scope.dropdown.close) { // check is for ts only\n              scope.dropdown.close();\n            }\n          }\n        }\n\n        function adjustHeight () {\n          if (angular.isDefined(scope.config.style.maxHeight)) {\n            domDropDownContent.style.maxHeight = scope.config.style.maxHeight;\n          } else {\n            let maxHeight = calculateDynamicMaxHeight();\n            domDropDownContent.style.maxHeight = maxHeight + 'px';\n\n          }\n        }\n\n        function resetHeight () {\n          domDropDownContent.style.maxHeight = '';\n        }\n\n        function calculateDynamicMaxHeight () {\n          let maxHeight;\n\n          let contentOffset = domDropDownContent.getBoundingClientRect().top;\n\n          let windowHeight = $window.innerHeight || $window.document.documentElement.clientHeight;\n\n          let containerHeight;\n          let containerOffset;\n\n          if (angular.isDefined(domHeightAdjustContainer)) {\n            containerHeight = domHeightAdjustContainer.innerHeight || domHeightAdjustContainer.clientHeight;\n            containerOffset = domHeightAdjustContainer.getBoundingClientRect().top;\n          } else {\n            containerHeight = $window.innerHeight || $window.document.documentElement.clientHeight;\n            containerOffset = 0;\n          }\n\n          if (scope.config.style.marginBottom.indexOf('px') < 0) {\n            throw new Error('Illegal Value for w11kSelectStyle.marginBottom');\n          }\n          let marginBottom = parseFloat(scope.config.style.marginBottom.slice(0, -2));\n\n          let referenceHeight;\n          let referenceOffset;\n\n          if (containerHeight + containerOffset > windowHeight) {\n            referenceHeight = windowHeight;\n            referenceOffset = 0;\n          } else {\n            referenceHeight = containerHeight;\n            referenceOffset = containerOffset;\n          }\n\n          maxHeight = referenceHeight - (contentOffset - referenceOffset) - marginBottom;\n\n          let minHeightFor3Elements = 93;\n          if (maxHeight < minHeightFor3Elements) {\n            maxHeight = minHeightFor3Elements;\n          }\n\n          return maxHeight;\n        }\n\n        scope.dropdown = {\n          onOpen: function ($event) {\n            if (scope.config.disabled) {\n              $event.prevent();\n              return;\n            }\n\n            if (hasBeenOpened === false) {\n              hasBeenOpened = true;\n            }\n            filterOptions();\n\n            $document.on('keyup', onEscPressed);\n\n            domDropDownMenu.style.visibility = 'hidden';\n            $timeout(function () {\n              adjustHeight();\n              domDropDownMenu.style.visibility = 'visible';\n\n              if (scope.config.filter.active) {\n                // use timeout to open dropdown first and then set the focus,\n                // otherwise focus won't be set because iElement is not visible\n                $timeout(function () {\n                  iElement[0].querySelector('.dropdown-menu input').focus();\n                });\n              }\n            });\n            jqWindow.on('resize', adjustHeight);\n\n            if (angular.isFunction(scope.config.dropdown.onOpen)) {\n              (scope.config.dropdown.onOpen as any)();\n            }\n          },\n          onClose: function () {\n            // important: set properties of filter.values to empty strings not to null,\n            // otherwise angular's filter won't work\n            scope.filter.values.label = '';\n\n            $timeout(function () {\n              resetHeight();\n            });\n            $document.off('keyup', onEscPressed);\n            jqWindow.off('resize', adjustHeight);\n\n            if (angular.isFunction(scope.config.dropdown.onClose)) {\n              (scope.config.dropdown.onClose as any)();\n            }\n          }\n        };\n\n        scope.$on('$destroy', function () {\n          $document.off('keyup', onEscPressed);\n          jqWindow.off('resize', adjustHeight);\n        });\n\n        scope.onKeyPressedOnDropDownToggle = function ($event) {\n          // enter or space\n          if ($event.keyCode === 13 || $event.keyCode === 32) {\n            $event.preventDefault();\n            $event.stopPropagation();\n\n            scope.dropdown.toggle();\n          }\n        };\n\n        function updateHeader () {\n          if (angular.isDefined(scope.config.header.text)) {\n            domHeaderText.textContent = scope.$parent.$eval(scope.config.header.text as any);\n          } else {\n            let arr = [];\n            internalOptions.forEach(option => collectActiveLabels(option, arr));\n            domHeaderText.textContent = arr.join(', ');\n          }\n        }\n\n        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n         * filter\n         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n        let initialLimitTo = 80;\n        let increaseLimitTo = initialLimitTo * 0.5;\n\n        function filterOptions () {\n          if (hasBeenOpened) {\n            // false as third parameter: use contains to compare\n            optionsFiltered = filterInternals(internalOptions, scope.filter.values.label ? scope.filter.values.label.toLowerCase() : '');\n            scope.options.visible = optionsFiltered.slice(0, initialLimitTo);\n          }\n        }\n\n        scope.showMoreOptions = function () {\n          scope.options.visible = optionsFiltered.slice(0, scope.options.visible.length + increaseLimitTo);\n        };\n\n        scope.onFilterValueChanged = function () {\n          filterOptions();\n        };\n\n        scope.clearFilter = function () {\n          scope.filter.values = {};\n          filterOptions();\n        };\n\n        scope.onKeyPressedInFilter = function ($event) {\n          // on enter\n          if ($event.keyCode === 13) {\n            $event.preventDefault();\n            $event.stopPropagation();\n\n            scope.selectFiltered();\n          }\n        };\n\n        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n         * buttons\n         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n        scope.selectFiltered = function ($event?) {\n          if (angular.isDefined($event)) {\n            $event.preventDefault();\n            $event.stopPropagation();\n          }\n          if (scope.config.children) {\n            setFilteredSelected(internalOptions);\n          } else if (scope.config.multiple) {\n            setSelected(optionsFiltered, true);\n          } else if (optionsFiltered.length === 1) {\n            scope.select(optionsFiltered[0]); // behaves like if the option was clicked using the mouse\n          }\n\n          setViewValue();\n        };\n\n        scope.deselectFiltered = function ($event) {\n          if (angular.isDefined($event)) {\n            $event.preventDefault();\n            $event.stopPropagation();\n          }\n\n          setSelected(optionsFiltered, false);\n          setViewValue();\n        };\n\n        scope.deselectAll = function ($event) {\n          if (angular.isDefined($event)) {\n            $event.preventDefault();\n            $event.stopPropagation();\n          }\n\n          setSelected(internalOptions, false);\n          setViewValue();\n        };\n\n        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n         * options\n         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n        let updateOptions = (function () {\n          let deferred = $q.defer<void>();\n          optionsAlreadyRead = deferred.promise;\n\n          return function updateOptions () {\n            let externalOptions = optionsExpParsed.collection(scope.$parent);\n            let viewValue = controller.$viewValue;\n\n            if (angular.isArray(externalOptions)) {\n              internalOptions = externalOptions2internalOptions(externalOptions, viewValue, w11kSelectHelper, optionsExpParsed, scope.config);\n              internalOptionsMap = {};\n              buildInternalOptionsMap(internalOptions,internalOptionsMap);\n              filterOptions();\n\n              if (ngModelAlreadyRead) {\n                updateNgModel();\n              }\n              deferred.resolve();\n            }\n          };\n        })();\n\n        // watch for changes of options collection made outside\n        scope.$watchCollection(\n            function externalOptionsWatch () {\n              return optionsExpParsed.collection(scope.$parent);\n            },\n            function externalOptionsWatchAction (newVal) {\n              if (angular.isDefined(newVal)) {\n                updateOptions();\n              }\n            }\n        );\n\n        scope.select = function select (option: InternalOption) {\n          // runs only if hierarchy is flat and multiple false\n\n          if (scope.config.multiple) {\n            setViewValue();\n            return;\n          }\n\n          // disable all others:\n          setSelected(internalOptions, false);\n          option.state = OptionState.selected;\n          setViewValue();\n          (scope.dropdown.close as any)();\n        };\n\n        /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n         * ngModel\n         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */\n\n        function setViewValue () {\n          let selectedValues = internalOptions2externalModel(internalOptions, optionsExpParsed, w11kSelectConfig);\n\n          let newViewValue: null|any[] = selectedValues;\n\n          if (scope.config.useNullableModel && selectedValues.length === 0) {\n            newViewValue = null;\n          }\n\n          controller.$setViewValue(newViewValue);\n          updateHeader();\n        }\n\n        function updateNgModel () {\n          let value: null|any[] = internalOptions2externalModel(internalOptions, optionsExpParsed, w11kSelectConfig);\n          angular.forEach(controller.$parsers, function (parser) {\n            value = parser(value);\n          });\n\n          if (scope.config.useNullableModel && (typeof value === 'undefined' || (angular.isArray(value) && value.length === 0))) {\n            value = null;\n          }\n\n          ngModelSetter(scope.$parent, value);\n        }\n\n        function render () {\n          optionsAlreadyRead.then(function () {\n            ngModelAlreadyRead = true;\n\n            let viewValue = controller.$viewValue;\n\n            setSelected(internalOptions, false);\n\n            let i = viewValue.length;\n            while (i--) {\n              let trackingId = value2trackingId(viewValue[i], w11kSelectHelper, optionsExpParsed);\n              let option = internalOptionsMap[trackingId];\n\n              if (option) {\n                option.state = OptionState.selected;\n              }\n            }\n\n            updateHeader();\n          });\n        }\n\n        function external2internal (modelValue) {\n          let viewValue;\n\n          if (angular.isArray(modelValue)) {\n            viewValue = modelValue;\n          } else if (angular.isDefined(modelValue) && !(scope.config.useNullableModel && modelValue === null)) {\n            viewValue = [modelValue];\n          } else {\n            viewValue = [];\n          }\n\n          return viewValue;\n        }\n\n        function internal2external (viewValue) {\n          if (angular.isUndefined(viewValue)) {\n            return;\n          } else if (scope.config.useNullableModel && viewValue === null) {\n            return null;\n          }\n\n          let modelValue;\n\n          if (scope.config.multiple || scope.config.forceArrayOutput) {\n            modelValue = viewValue;\n          } else {\n            modelValue = viewValue[0];\n          }\n\n          return modelValue;\n        }\n\n        function validateRequired (value): boolean {\n          if (scope.config.required) {\n            if (scope.config.multiple === true && (angular.isArray(value) && value.length === 0)) {\n              return false;\n            }\n            if (scope.config.multiple === false && scope.config.forceArrayOutput === true && (angular.isArray(value) && value.length === 0)) {\n              return false;\n            }\n            if (scope.config.multiple === false && value === undefined) {\n              return false;\n            }\n\n          }\n\n          return true;\n        }\n\n        function isEmpty () {\n          let value = controller.$viewValue;\n          return !(angular.isArray(value) && value.length > 0) || (scope.config.useNullableModel && value === null);\n        }\n\n        scope.isEmpty = isEmpty;\n\n        controller.$isEmpty = isEmpty;\n\n        controller.$render = render;\n        controller.$formatters.push(external2internal);\n        controller.$validators.required = validateRequired;\n        controller.$parsers.push(internal2external);\n\n      };\n    }\n  };\n}\n\nfunction checkConfig (config: ConfigInstance, setViewValue) {\n  /**\n   *  Currently there is a bug if multiple = false and required = true.\n   *  Then the validator runs only once, before the config is present\n   *  and returns a wrong validation state.\n   *  might be fixed by calling updateNgModel() here\n   */\n  // throw error if multiple is false and childrenKey is present\n  if (config.children && !config.multiple) {\n    throw new Error('Multiple must be enabled when displaying hierarchically structure');\n  }\n  if (config.children) {\n    setViewValue();\n  }\n}\n","import {OptionState} from '../model/option-state.enum';\nimport {InternalOption} from '../model/internal-option.model';\nimport {Config} from '../model/config.model';\nimport {IDirective} from 'angular';\n\nclass Result {\n  selected: number = 0;\n  unselected: number = 0;\n  childsSelected: number = 0;\n  length: number;\n\n  constructor (length: number) {\n    this.length = length;\n  }\n}\n\nexport function w11kSelectOptionDirective (w11kSelectConfig: Config): IDirective {\n  'ngInject';\n\n  return {\n    restrict: 'A',\n    replace: false,\n    templateUrl: w11kSelectConfig.common.templateUrlOptions,\n    scope: {\n      'options': '=',\n      'parent': '=',\n      'select': '&'\n    },\n    require: 'ngModel',\n    controller: function ($scope) {\n      if ($scope.$parent.childsMap) {\n        $scope.$parent.addChild($scope, $scope.parent);\n      }\n      $scope.childsMap = {};\n\n      $scope.upwardsClick = function (clickedOption: InternalOption, res: Result) {\n        let fatherOption: InternalOption = $scope.options.find(option => option.trackingId === clickedOption.parent);\n        if (res.selected === 0 && res.childsSelected === 0) {\n          setSelected(fatherOption, OptionState.unselected, $scope);\n        } else if (res.selected === res.length) {\n          setSelected(fatherOption, OptionState.selected, $scope);\n        } else {\n          setSelected(fatherOption, OptionState.childsSelected, $scope);\n\n        }\n\n        if ($scope.$parent.upwardsClick) {\n          let res = calcRes($scope.options);\n          $scope.$parent.upwardsClick(fatherOption, res);\n        }\n      };\n\n      $scope.addChild = function (childScope, father) {\n        $scope.childsMap[father.trackingId] = childScope;\n      };\n      $scope.onOptionStateClick = function ($event, option: InternalOption) {\n\n        switch (option.state) {\n          case OptionState.unselected:\n            setSelected(option, OptionState.selected, $scope);\n            break;\n          case OptionState.selected:\n            setSelected(option, OptionState.unselected, $scope);\n            break;\n          case OptionState.childsSelected:\n            setSelected(option, OptionState.selected, $scope);\n            break;\n        }\n\n        // upwards Click\n        if ($scope.$parent.upwardsClick) {\n          let res = calcRes($scope.options);\n          $scope.$parent.upwardsClick(option, res);\n        }\n\n        $scope.childsMap[option.trackingId].downWardstoggleAll(option.state);\n      };\n\n      $scope.downWardstoggleAll = function (toSetState: OptionState) {\n        $scope.options = toggleDownWards($scope.options, toSetState, $scope);\n      };\n\n      $scope.filterSearchResultsInView = function (item) {\n        return item.isSearchResultOrParent;\n      };\n    }\n  };\n}\n\nfunction toggleDownWards (options: InternalOption[], toSetState: OptionState, $scope): InternalOption[] {\n  return options.map(\n      option => {\n        option.children = toggleDownWards(option.children, toSetState, $scope);\n        setSelected(option, toSetState, $scope);\n        return option;\n      }\n  );\n}\n\nfunction calcRes (options: InternalOption[]): Result {\n  return options.reduce(\n      (prev: Result, next: InternalOption) => {\n        if (next.state === OptionState.selected) {\n          prev.selected++;\n        }\n        if (next.state === OptionState.unselected) {\n          prev.unselected++;\n        }\n        if (next.state === OptionState.childsSelected) {\n          prev.childsSelected++;\n        }\n\n        return prev;\n\n      },\n      new Result(options.length));\n}\n\nfunction setSelected (option: InternalOption, optionState: OptionState, $scope) {\n  option.state = optionState;\n  $scope.select({option: option});\n}\n","import {OptionState} from '../model/option-state.enum';\nimport {IDirective} from 'angular';\n\nexport class W11KSelectCheckbox {\n  state: OptionState;\n  toggle: Function;\n\n  getClass (state: OptionState): string {\n    return OptionState[state];\n  }\n\n}\n\nexport function w11kSelectCheckboxDirective (): IDirective {\n  return {\n    scope: {\n      'state': '=',\n    },\n    bindToController: true,\n    controllerAs: '$ctrl',\n    template: `<a class=\"w11k-checkbox\" ng-class=\"$ctrl.getClass($ctrl.state)\"></a>`,\n    restrict: 'E',\n    controller: W11KSelectCheckbox\n  };\n}\n","export function w11kSelectInfiniteScroll($timeout) {\n  'ngInject';\n  return {\n    link: function (scope, element, attrs) {\n      let scrollDistance = 0;\n      let scrollEnabled = true;\n      let checkImmediatelyWhenEnabled = false;\n\n      let onDomScrollHandler = function () {\n        onScrollHandler(true);\n      };\n\n      let scrollContainer = element[0];\n\n      if (scrollContainer.children.length !== 1) {\n        throw new Error('scroll container has to have exactly one child!');\n      }\n\n      let content = scrollContainer.children[0];\n\n      let onScrollHandler = function (apply?) {\n\n        let distanceToBottom = content.clientHeight - scrollContainer.scrollTop;\n        let shouldScroll = distanceToBottom <= scrollContainer.clientHeight * (scrollDistance + 1);\n\n        if (shouldScroll && scrollEnabled) {\n          if (apply) {\n            scope.$apply(function () {\n              scope.$eval(attrs.w11kSelectInfiniteScroll);\n            });\n          }\n          else {\n            scope.$eval(attrs.w11kSelectInfiniteScroll);\n          }\n        }\n        else if (shouldScroll) {\n          checkImmediatelyWhenEnabled = true;\n        }\n      };\n\n      attrs.$observe('w11kSelectInfiniteScrollDistance', function (value: any) {\n        scrollDistance = parseFloat(value);\n      });\n\n\n      attrs.$observe('w11kSelectInfiniteScrollDisabled', function (value: any) {\n        scrollEnabled = !value;\n\n        if (scrollEnabled && checkImmediatelyWhenEnabled) {\n          checkImmediatelyWhenEnabled = false;\n          onScrollHandler();\n        }\n      });\n\n      element.on('scroll', onDomScrollHandler);\n      scope.$on('$destroy', function () {\n        element.off('scroll', onDomScrollHandler);\n      });\n\n      return $timeout(function () {\n        if (attrs.w11kSelectInfiniteScrollImmediateCheck) {\n          if (scope.$eval(attrs.w11kSelectInfiniteScrollImmediateCheck)) {\n            onScrollHandler();\n          }\n        }\n      });\n    }\n  };\n}\n","export function keyListener () {\n  return function (scope, elm, attrs) {\n    // prevent scroll on space click\n    elm.bind('keydown', function (event) {\n      if (event.keyCode === 32) {\n        event.preventDefault();\n      }\n    });\n\n    // trigger click on spacer || enter\n    elm.bind('keyup', function (event) {\n      if (event.keyCode === 32 || event.keyCode === 13) {\n        scope.$apply(attrs.keyListener);\n      }\n    });\n\n  };\n}\n","export class ConfigCommon {\n  templateUrl: string = 'w11k-select.tpl.html';\n  templateUrlOptions: string = 'w11k-select-option.tpl.html';\n}\nexport interface StyleConfig {\n  marginBottom: '10px';\n  maxHeight: undefined | string;\n}\n\nexport interface FilterConfig {\n  active: boolean;\n  placeholder: string;\n  select: {\n    active: boolean;\n    text: undefined | string;\n  };\n  deselect: {\n    active: true,\n    text: undefined | string;\n  };\n}\n\nexport class ConfigInstance {\n  /** for form validation */\n  required: boolean = false;\n  /** Hide checkboxes during single selection */\n  hideCheckboxes: boolean = false;\n  /** single or multiple select */\n  multiple: boolean = true;\n  /** force ngModel to be an array for single select too */\n  forceArrayOutput = false;\n  /** disable user interaction */\n  disabled: boolean = false;\n  /** all the configuration for the header (visible if dropdown closed) */\n  header = {\n    /** text to show if no item selected (plain text, no evaluation, no data-binding) */\n    placeholder: '',\n    /**\n     * text to show if item(s) selected (expression, evaluated against user scope)\n     * make sure to enclose your expression withing quotes, otherwise it will be evaluated too early\n     * default: undefined evaluates to a comma separated representation of selected items\n     * example: ng-model='options.selected' w11k-select-config='{header: {placeholder: 'options.selected.length'}}'\n     */\n    text: undefined\n  };\n  dropdown: {\n    onOpen: (() => void) | undefined,\n    onClose: (() => void) | undefined\n  } = {\n    onOpen: undefined,\n    onClose: undefined\n  };\n  /** all the configuration for the filter section within the dropdown */\n  filter: FilterConfig = {\n    /** activate filter input to search for options */\n    active: true,\n    /** text to show if no filter is applied */\n    placeholder: 'Filter',\n    /** 'select all filtered options' button */\n    select: {\n      /** show select all button */\n      active: true,\n      /**\n       * label for select all button\n       * default: undefined evaluates to 'all'\n       */\n      text: undefined\n    },\n    /** 'deselect all filtered options' button */\n    deselect: {\n      /** show deselect all button */\n      active: true,\n      /**\n       * label for deselect all button\n       * default: undefined evaluates to 'none'\n       */\n      text: undefined\n    }\n  };\n\n  /** values for dynamically calculated styling of dropdown */\n  style: StyleConfig = {\n    /** margin-bottom for automatic height adjust */\n    marginBottom: '10px',\n    /** static or manually calculated max height (disables internal height calculation) */\n    maxHeight: undefined\n  };\n  /** when set to true, the clear-button is always visible. */\n  showClearAlways: boolean = false;\n  /** when set to true, we force the view value and external value to be null rather than undefined when 0 options are selected */\n  useNullableModel: boolean = false;\n  children: string;\n\n}\n\nexport class Config {\n  common: ConfigCommon;\n  instance: ConfigInstance;\n\n  constructor (common?: ConfigCommon, instance?: ConfigInstance) {\n    this.common = common || new ConfigCommon();\n    this.instance = instance || new ConfigInstance();\n  }\n}\n","export enum OptionState {\n  unselected,\n  selected,\n  childsSelected\n}\n","/** @internal */\nimport * as angular from 'angular';\nimport {IDocumentService, IParseService} from 'angular';\n\nexport class W11KSelectHelper {\n\n  //               value                 as    label                for       item              in    collection                    |  filter                        track by     tracking\n  OPTIONS_EXP = /^([a-zA-Z][\\w\\.]*)(?:\\s+as\\s+([a-zA-Z][\\w\\.]*))?\\s+for\\s+(?:([a-zA-Z][\\w]*))\\s+in\\s+([$_a-zA-Z][\\w\\.\\(\\)]*(?:\\s+\\|\\s[a-zA-Z][\\w\\:_\\{\\}']*)*)(?:\\s+track\\sby\\s+([a-zA-Z][\\w\\.]*))?$/;\n\n  constructor (public $parse: IParseService,\n               public $document: IDocumentService) {\n    'ngInject';\n\n  }\n\n  extendDeep (dst, ...otherArgs) {\n    angular.forEach(otherArgs, (obj) => {\n      if (obj !== dst) {\n        angular.forEach(obj, (value, key) => {\n          if (dst[key] && dst[key].constructor && dst[key].constructor === Object) {\n            this.extendDeep(dst[key], value);\n          } else {\n            dst[key] = value;\n          }\n        });\n      }\n    });\n    return dst;\n  }\n\n  hashCode (value) {\n    let valueAsString: string;\n    if (typeof value === 'object') {\n      valueAsString = angular.toJson(value);\n    } else {\n      valueAsString = value.toString();\n    }\n\n    let hash = 0;\n    let length = valueAsString.length;\n    for (let i = 0; i < length; i++) {\n      hash = valueAsString.charCodeAt(i) + (hash << 6) + (hash << 16) - hash;\n    }\n\n    return hash.toString(36);\n  }\n\n  parseOptions (input) {\n\n    let match = input.match(this.OPTIONS_EXP);\n    if (!match) {\n      let expected = '\"item.value\" [as \"item.label\"] for \"item\" in \"collection [ | filter ] [track by item.value.unique]\"';\n      throw new Error('Expected options in form of \\'' + expected + '\\' but got \"' + input + '\".');\n    }\n\n    let result: any = {\n      value: this.$parse(match[1]),\n      label: this.$parse(match[2] || match[1]),\n      item: match[3],\n      collection: this.$parse(match[4])\n    };\n\n    if (match[5] !== undefined) {\n      result.tracking = this.$parse(match[5]);\n    }\n\n    return result;\n  }\n\n  getParent (element, selector) {\n    // with jQuery\n    if (angular.isFunction(element.parents)) {\n      let container = element.parents(selector);\n      if (container.length > 0) {\n        return container[0];\n      }\n\n      return;\n    }\n\n    // without jQuery\n    let matchesSelector = 'MatchesSelector';\n    let matchFunctions = [\n      'matches',\n      'matchesSelector',\n      'moz' + matchesSelector,\n      'webkit' + matchesSelector,\n      'ms' + matchesSelector,\n      'o' + matchesSelector\n    ];\n\n    for (let index in matchFunctions) {\n      let matchFunction = matchFunctions[index];\n      if (angular.isFunction(element[0][matchFunction])) {\n        let parent1 = element[0].parentNode;\n        while (parent1 !== this.$document[0]) {\n          if (parent1[matchFunction](selector)) {\n            return parent1;\n          }\n          parent1 = parent1.parentNode;\n        }\n\n        return;\n      }\n    }\n\n    return;\n  }\n}\n","import {OptionState} from './option-state.enum';\n\nexport class InternalOption {\n\n  trackingId: string;\n  label: string;\n  model: any;\n  selected: boolean;\n  state: OptionState;\n  children: InternalOption[];\n  isSearchResultOrParent: boolean;\n  parent: any;\n\n  constructor (trackingId: string, label: string, model: any, selected: boolean, state: OptionState, children: InternalOption[], parent: any) {\n    this.trackingId = trackingId;\n    this.label = label;\n    this.model = model;\n    this.selected = selected;\n    this.state = state;\n    this.children = children;\n    this.parent = parent;\n    this.isSearchResultOrParent = true;\n  }\n}\n","'use strict';\n/** @internal */\nimport * as angular from 'angular';\nimport {IModule} from 'angular';\nimport {Config} from './model/config.model';\nimport {W11KSelectHelper} from './w11k-select-helper.factory';\nimport {w11kSelect} from './w11k-select.directive';\nimport {w11kSelectOptionDirective} from './w11k-select-option/w11k-select-option.directive';\nimport {w11kSelectCheckboxDirective} from './w11k-select-checkbox/w11k-checkbox.directive';\nimport {w11kSelectInfiniteScroll} from './w11k-select-infinite-scroll.directive';\nimport {keyListener} from './lib/key-listener';\n\nexport const module: IModule = angular.module('w11k.select', [\n  'w11k.dropdownToggle',\n  'w11k.select.template'\n]);\n\nmodule\n    .constant('w11kSelectConfig', new Config())\n    .directive('w11kSelectInfiniteScroll', w11kSelectInfiniteScroll)\n    .service('w11kSelectHelper', W11KSelectHelper)\n    .directive('w11kSelect', w11kSelect)\n    .directive('w11kSelectOption', w11kSelectOptionDirective)\n    .directive('w11kSelectCheckbox', w11kSelectCheckboxDirective)\n    .directive('keyListener', keyListener);\n"],"names":["options","selected","i","length","state","OptionState","unselected","setSelected","children","forEach","option","isSearchResultOrParent","setFilteredSelected","optionsExpParsed","context","item","value","externalOption2value","model","config","arr","traverse","push","internalOption2value","w11kSelectHelper","undefined","tracking","assignValueFn","assign","trackingValue","Error","toString","hashCode","label","externalOptions","viewValue","externalOption","parent","trackingId","value2trackingId","externalOption2label","internalOption","InternalOption","viewValueIDs","map","child","prepareOptions","labelArray","collectActiveLabels","internalOptions","internalOptionsMap","buildInternalOptionsMap","resource","some","ContainsResult","w11kSelectConfig","$parse","$document","$filter","$timeout","$window","$q","jqWindow","angular.element","restrict","replace","templateUrl","common","scope","require","controller","$scope","$attrs","w11kSelect","exposeExpression","$parent","this","open","dropdown","close","toggle","compile","tElement","tAttrs","configExpParsed","parseOptions","w11kSelectOptions","ngModelSetter","ngModel","iElement","iAttrs","optionsAlreadyRead","then","checkSelection","updateNgModel","checkConfig","setViewValue","configRead","updateStaticTexts","filter","select","active","text","selectFilteredButton","domElement","querySelector","textContent","deselect","deselectFilteredButton","header","placeholder","headerPlaceholder","multiple","selectedOptions","event","keyCode","angular.isDefined","style","maxHeight","domDropDownContent","calculateDynamicMaxHeight","containerHeight","containerOffset","contentOffset","getBoundingClientRect","top","windowHeight","innerHeight","document","documentElement","clientHeight","domHeightAdjustContainer","marginBottom","indexOf","referenceHeight","referenceOffset","parseFloat","slice","minHeightFor3Elements","domHeaderText","$eval","arr_1","join","hasBeenOpened","optionsFiltered","filterInternals","values","toLowerCase","visible","initialLimitTo","selectedValues","internalOptions2externalModel","newViewValue","useNullableModel","$setViewValue","updateHeader","angular.forEach","$parsers","parser","angular.isArray","ngModelAlreadyRead","$viewValue","modelValue","angular.isUndefined","forceArrayOutput","required","angular.copy","instance","$watch","newConfig","extendDeep","apply","concat","applyConfig","angular.isObject","domDropDownMenu","getParent","onOpen","$event","disabled","prevent","filterOptions","on","onEscPressed","visibility","adjustHeight","focus","angular.isFunction","onClose","resetHeight","off","$on","onKeyPressedOnDropDownToggle","preventDefault","stopPropagation","increaseLimitTo","showMoreOptions","onFilterValueChanged","clearFilter","onKeyPressedInFilter","selectFiltered","deselectFiltered","deselectAll","updateOptions","deferred","defer","promise","collection","externalOptions2internalOptions","resolve","$watchCollection","newVal","isEmpty","$isEmpty","$render","render","$formatters","external2internal","$validators","validateRequired","internal2external","templateUrlOptions","childsMap","addChild","upwardsClick","clickedOption","res","fatherOption","find","childsSelected","res_1","calcRes","childScope","father","onOptionStateClick","downWardstoggleAll","toSetState","toggleDownWards","filterSearchResultsInView","reduce","prev","next","Result","optionState","bindToController","controllerAs","template","W11KSelectCheckbox","link","element","attrs","scrollDistance","scrollEnabled","checkImmediatelyWhenEnabled","onDomScrollHandler","onScrollHandler","scrollContainer","content","distanceToBottom","scrollTop","shouldScroll","$apply","w11kSelectInfiniteScroll","$observe","w11kSelectInfiniteScrollImmediateCheck","elm","bind","keyListener","ConfigCommon","ConfigInstance","W11KSelectHelper","dst","_i","otherArgs","obj","key","constructor","Object","_this","valueAsString","angular.toJson","hash","charCodeAt","input","match","OPTIONS_EXP","expected","result","selector","parents","container","matchesSelector","matchFunctions","index","matchFunction","parent1","parentNode","resourceList","searchStr","it","arrayExistsAndContains","includes","module","angular.module","constant","Config","directive","service","w11kSelectOptionDirective","w11kSelectCheckboxDirective"],"mappings":"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"}